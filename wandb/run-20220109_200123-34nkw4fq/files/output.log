cross_validation: True
Preprocessing...
Preparing input...
Input was already prepared
Use `python3 -m tensorboard.main --logdir=./logs/` to visualize accuracy and AUC graphs in real time
Starting 5-fold cross validation study...
Set 1
Diversity of Training Set: Class 0: 60 Class 1: 64
Diversity of Validation Set: Class 0: 17 Class 1: 14
Loading the Training Dataset...
100% 155/155 [00:00<00:00, 90861.93it/s]
WARNING:tensorflow:From /content/tbcnn/train_loop.py:223: shuffle_and_repeat (from tensorflow.python.data.experimental.ops.shuffle_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.shuffle(buffer_size, seed)` followed by `tf.data.Dataset.repeat(count)`. Static tf.data optimizations will take care of using the fused implementation.
WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/tensorflow/python/autograph/impl/api.py:465: py_func (from tensorflow.python.ops.script_ops) is deprecated and will be removed in a future version.
Instructions for updating:
tf.py_func is deprecated in TF V2. Instead, there are two
    options available in V2.
    - tf.py_function takes a python function which manipulates tf eager
    tensors instead of numpy arrays. It's easy to convert a tf eager tensor to
    an ndarray (just call tensor.numpy()) but having access to eager tensors
    means `tf.py_function`s can use accelerators such as GPUs as well as
    being differentiable using a gradient tape.
    - tf.numpy_function maintains the semantics of the deprecated tf.py_func
    (it is not differentiable, and manipulates numpy arrays). It drops the
    stateful argument making all functions stateful.
WARNING:tensorflow:From /content/tbcnn/train_loop.py:231: DatasetV1.make_one_shot_iterator (from tensorflow.python.data.ops.dataset_ops) is deprecated and will be removed in a future version.
Instructions for updating:
This is a deprecated API that should only be used in TF 1 graph mode and legacy TF 2 graph mode available through `tf.compat.v1`. In all other situations -- namely, eager mode and inside `tf.function` -- you can consume dataset elements using `for elem in dataset: ...` or by explicitly creating iterator via `iterator = iter(dataset)` and fetching its elements via `values = next(iterator)`. Furthermore, this API is not available in TF 2. During the transition from TF 1 to TF 2 you can use `tf.compat.v1.data.make_one_shot_iterator(dataset)` to create a TF 1 graph mode style iterator for a dataset created through TF 2 APIs. Note that this should be a transient state of your code base as there are in general no guarantees about the interoperability of TF 1 and TF 2 code.
WARNING:tensorflow:From /content/tbcnn/net.py:17: The name tf.keras.initializers.he_normal is deprecated. Please use tf.compat.v1.keras.initializers.he_normal instead.
/content/tbcnn/net.py:21: UserWarning: `tf.layers.batch_normalization` is deprecated and will be removed in a future version. Please use `tf.keras.layers.BatchNormalization` instead. In particular, `tf.control_dependencies(tf.GraphKeys.UPDATE_OPS)` should not be used (consult the `tf.keras.layers.BatchNormalization` documentation).
  output = tf.layers.batch_normalization(output)
/usr/local/lib/python3.7/dist-packages/keras/legacy_tf_layers/normalization.py:455: UserWarning: `layer.apply` is deprecated and will be removed in a future version. Please use `layer.__call__` method instead.
  return layer.apply(inputs, training=training)
/content/tbcnn/net.py:35: UserWarning: `tf.layers.batch_normalization` is deprecated and will be removed in a future version. Please use `tf.keras.layers.BatchNormalization` instead. In particular, `tf.control_dependencies(tf.GraphKeys.UPDATE_OPS)` should not be used (consult the `tf.keras.layers.BatchNormalization` documentation).
  parallel = tf.layers.batch_normalization(parallel)
Loaded the Training Dataset...
Loaded the Training Data Iterator...
Parameter number: 184834
WARNING:tensorflow:From /content/tbcnn/net.py:98: auc (from tensorflow.python.ops.metrics_impl) is deprecated and will be removed in a future version.
Instructions for updating:
The value of AUC returned by this may race with the update so this is deprecated. Please use tf.keras.metrics.AUC instead.
Epoch   0 | Time:  22 s | Acc: 0.556 (Test: 0.452) | AUC: 0.556 (Test: 0.557) | Precision: 0.565 (Test: 0.452) | Recall: 0.609 (Test: 1.000)
Epoch   1 | Time:  14 s | Acc: 0.516 (Test: 0.452) | AUC: 0.444 (Test: 0.668) | Precision: 0.516 (Test: 0.452) | Recall: 1.000 (Test: 1.000)
Epoch   2 | Time:  13 s | Acc: 0.532 (Test: 0.645) | AUC: 0.626 (Test: 0.748) | Precision: 0.526 (Test: 0.588) | Recall: 0.938 (Test: 0.714)
Epoch   3 | Time:  14 s | Acc: 0.556 (Test: 0.645) | AUC: 0.518 (Test: 0.748) | Precision: 0.545 (Test: 0.571) | Recall: 0.844 (Test: 0.857)
Epoch   4 | Time:  13 s | Acc: 0.540 (Test: 0.613) | AUC: 0.545 (Test: 0.750) | Precision: 0.551 (Test: 0.600) | Recall: 0.594 (Test: 0.429)
Epoch   5 | Time:  14 s | Acc: 0.500 (Test: 0.613) | AUC: 0.490 (Test: 0.754) | Precision: 0.513 (Test: 0.556) | Recall: 0.609 (Test: 0.714)
Epoch   6 | Time:  14 s | Acc: 0.532 (Test: 0.452) | AUC: 0.610 (Test: 0.714) | Precision: 0.531 (Test: 0.452) | Recall: 0.812 (Test: 1.000)
Epoch   7 | Time:  14 s | Acc: 0.565 (Test: 0.677) | AUC: 0.660 (Test: 0.750) | Precision: 0.544 (Test: 0.833) | Recall: 0.969 (Test: 0.357)
Epoch   8 | Time:  14 s | Acc: 0.556 (Test: 0.645) | AUC: 0.619 (Test: 0.742) | Precision: 0.585 (Test: 0.560) | Recall: 0.484 (Test: 1.000)
Epoch   9 | Time:  14 s | Acc: 0.565 (Test: 0.645) | AUC: 0.665 (Test: 0.742) | Precision: 0.554 (Test: 0.565) | Recall: 0.797 (Test: 0.929)
Epoch  10 | Time:  14 s | Acc: 0.573 (Test: 0.548) | AUC: 0.650 (Test: 0.721) | Precision: 0.570 (Test: 0.500) | Recall: 0.703 (Test: 1.000)
Epoch  11 | Time:  14 s | Acc: 0.573 (Test: 0.645) | AUC: 0.645 (Test: 0.731) | Precision: 0.558 (Test: 0.560) | Recall: 0.828 (Test: 1.000)
Epoch  12 | Time:  14 s | Acc: 0.621 (Test: 0.645) | AUC: 0.669 (Test: 0.746) | Precision: 0.620 (Test: 0.579) | Recall: 0.688 (Test: 0.786)
Epoch  13 | Time:  13 s | Acc: 0.621 (Test: 0.677) | AUC: 0.711 (Test: 0.729) | Precision: 0.623 (Test: 0.583) | Recall: 0.672 (Test: 1.000)
Epoch  14 | Time:  13 s | Acc: 0.597 (Test: 0.677) | AUC: 0.639 (Test: 0.727) | Precision: 0.587 (Test: 0.583) | Recall: 0.734 (Test: 1.000)
Epoch  15 | Time:  14 s | Acc: 0.573 (Test: 0.484) | AUC: 0.602 (Test: 0.704) | Precision: 0.582 (Test: 0.467) | Recall: 0.609 (Test: 1.000)
Epoch  16 | Time:  13 s | Acc: 0.653 (Test: 0.613) | AUC: 0.755 (Test: 0.748) | Precision: 0.608 (Test: 0.583) | Recall: 0.922 (Test: 0.500)
Epoch  17 | Time:  14 s | Acc: 0.597 (Test: 0.677) | AUC: 0.650 (Test: 0.737) | Precision: 0.606 (Test: 0.583) | Recall: 0.625 (Test: 1.000)
Epoch  18 | Time:  14 s | Acc: 0.605 (Test: 0.613) | AUC: 0.709 (Test: 0.750) | Precision: 0.586 (Test: 0.545) | Recall: 0.797 (Test: 0.857)
Epoch  19 | Time:  14 s | Acc: 0.653 (Test: 0.645) | AUC: 0.690 (Test: 0.756) | Precision: 0.667 (Test: 0.615) | Recall: 0.656 (Test: 0.571)
Epoch  20 | Time:  13 s | Acc: 0.613 (Test: 0.645) | AUC: 0.695 (Test: 0.761) | Precision: 0.629 (Test: 0.615) | Recall: 0.609 (Test: 0.571)
Epoch  21 | Time:  15 s | Acc: 0.581 (Test: 0.645) | AUC: 0.693 (Test: 0.750) | Precision: 0.573 (Test: 0.560) | Recall: 0.734 (Test: 1.000)
Epoch  22 | Time:  14 s | Acc: 0.694 (Test: 0.613) | AUC: 0.752 (Test: 0.748) | Precision: 0.691 (Test: 0.538) | Recall: 0.734 (Test: 1.000)
Epoch  23 | Time:  14 s | Acc: 0.621 (Test: 0.677) | AUC: 0.678 (Test: 0.765) | Precision: 0.616 (Test: 0.583) | Recall: 0.703 (Test: 1.000)
Epoch  24 | Time:  13 s | Acc: 0.613 (Test: 0.677) | AUC: 0.685 (Test: 0.752) | Precision: 0.629 (Test: 0.583) | Recall: 0.609 (Test: 1.000)
Epoch  25 | Time:  14 s | Acc: 0.726 (Test: 0.645) | AUC: 0.779 (Test: 0.775) | Precision: 0.742 (Test: 0.579) | Recall: 0.719 (Test: 0.786)
Epoch  26 | Time:  14 s | Acc: 0.718 (Test: 0.613) | AUC: 0.756 (Test: 0.771) | Precision: 0.723 (Test: 0.550) | Recall: 0.734 (Test: 0.786)
Epoch  27 | Time:  14 s | Acc: 0.734 (Test: 0.677) | AUC: 0.780 (Test: 0.758) | Precision: 0.754 (Test: 0.583) | Recall: 0.719 (Test: 1.000)
Epoch  28 | Time:  13 s | Acc: 0.645 (Test: 0.613) | AUC: 0.751 (Test: 0.775) | Precision: 0.628 (Test: 0.550) | Recall: 0.766 (Test: 0.786)
Epoch  29 | Time:  14 s | Acc: 0.661 (Test: 0.677) | AUC: 0.724 (Test: 0.782) | Precision: 0.683 (Test: 0.625) | Recall: 0.641 (Test: 0.714)
Epoch  30 | Time:  14 s | Acc: 0.758 (Test: 0.677) | AUC: 0.765 (Test: 0.796) | Precision: 0.743 (Test: 0.667) | Recall: 0.812 (Test: 0.571)
Epoch  31 | Time:  14 s | Acc: 0.694 (Test: 0.677) | AUC: 0.753 (Test: 0.763) | Precision: 0.710 (Test: 0.583) | Recall: 0.688 (Test: 1.000)
Epoch  32 | Time:  14 s | Acc: 0.702 (Test: 0.710) | AUC: 0.768 (Test: 0.775) | Precision: 0.714 (Test: 0.609) | Recall: 0.703 (Test: 1.000)
Epoch  33 | Time:  14 s | Acc: 0.742 (Test: 0.677) | AUC: 0.790 (Test: 0.769) | Precision: 0.786 (Test: 0.583) | Recall: 0.688 (Test: 1.000)
Epoch  34 | Time:  13 s | Acc: 0.669 (Test: 0.677) | AUC: 0.710 (Test: 0.771) | Precision: 0.683 (Test: 0.591) | Recall: 0.672 (Test: 0.929)
Epoch  35 | Time:  14 s | Acc: 0.677 (Test: 0.581) | AUC: 0.754 (Test: 0.756) | Precision: 0.700 (Test: 0.519) | Recall: 0.656 (Test: 1.000)
Epoch  36 | Time:  14 s | Acc: 0.685 (Test: 0.677) | AUC: 0.740 (Test: 0.756) | Precision: 0.681 (Test: 0.583) | Recall: 0.734 (Test: 1.000)
Epoch  37 | Time:  14 s | Acc: 0.750 (Test: 0.710) | AUC: 0.788 (Test: 0.790) | Precision: 0.739 (Test: 0.692) | Recall: 0.797 (Test: 0.643)
Epoch  38 | Time:  13 s | Acc: 0.694 (Test: 0.645) | AUC: 0.765 (Test: 0.788) | Precision: 0.750 (Test: 0.588) | Recall: 0.609 (Test: 0.714)
Epoch  39 | Time:  14 s | Acc: 0.677 (Test: 0.677) | AUC: 0.749 (Test: 0.792) | Precision: 0.688 (Test: 0.700) | Recall: 0.688 (Test: 0.500)
Epoch  40 | Time:  14 s | Acc: 0.710 (Test: 0.710) | AUC: 0.784 (Test: 0.792) | Precision: 0.741 (Test: 0.692) | Recall: 0.672 (Test: 0.643)
Epoch  41 | Time:  12 s | Acc: 0.734 (Test: 0.710) | AUC: 0.774 (Test: 0.769) | Precision: 0.772 (Test: 0.609) | Recall: 0.688 (Test: 1.000)
Epoch  42 | Time:  13 s | Acc: 0.718 (Test: 0.677) | AUC: 0.779 (Test: 0.794) | Precision: 0.730 (Test: 0.611) | Recall: 0.719 (Test: 0.786)
Epoch  43 | Time:  13 s | Acc: 0.758 (Test: 0.645) | AUC: 0.806 (Test: 0.786) | Precision: 0.774 (Test: 0.579) | Recall: 0.750 (Test: 0.786)
Epoch  44 | Time:  13 s | Acc: 0.750 (Test: 0.710) | AUC: 0.806 (Test: 0.769) | Precision: 0.746 (Test: 0.609) | Recall: 0.781 (Test: 1.000)
Epoch  45 | Time:  14 s | Acc: 0.726 (Test: 0.710) | AUC: 0.791 (Test: 0.786) | Precision: 0.734 (Test: 0.667) | Recall: 0.734 (Test: 0.714)
Epoch  46 | Time:  13 s | Acc: 0.702 (Test: 0.645) | AUC: 0.749 (Test: 0.790) | Precision: 0.755 (Test: 0.615) | Recall: 0.625 (Test: 0.571)
Epoch  47 | Time:  14 s | Acc: 0.710 (Test: 0.613) | AUC: 0.757 (Test: 0.754) | Precision: 0.741 (Test: 0.538) | Recall: 0.672 (Test: 1.000)
Epoch  48 | Time:  13 s | Acc: 0.685 (Test: 0.677) | AUC: 0.759 (Test: 0.769) | Precision: 0.705 (Test: 0.583) | Recall: 0.672 (Test: 1.000)
Epoch  49 | Time:  13 s | Acc: 0.702 (Test: 0.677) | AUC: 0.754 (Test: 0.763) | Precision: 0.714 (Test: 0.583) | Recall: 0.703 (Test: 1.000)
Epoch  50 | Time:  14 s | Acc: 0.774 (Test: 0.677) | AUC: 0.809 (Test: 0.803) | Precision: 0.757 (Test: 0.667) | Recall: 0.828 (Test: 0.571)
Epoch  51 | Time:  13 s | Acc: 0.685 (Test: 0.613) | AUC: 0.777 (Test: 0.782) | Precision: 0.727 (Test: 0.556) | Recall: 0.625 (Test: 0.714)
Epoch  52 | Time:  13 s | Acc: 0.734 (Test: 0.645) | AUC: 0.767 (Test: 0.786) | Precision: 0.782 (Test: 0.571) | Recall: 0.672 (Test: 0.857)
Epoch  53 | Time:  13 s | Acc: 0.710 (Test: 0.645) | AUC: 0.784 (Test: 0.744) | Precision: 0.750 (Test: 0.560) | Recall: 0.656 (Test: 1.000)
Epoch  54 | Time:  13 s | Acc: 0.710 (Test: 0.677) | AUC: 0.755 (Test: 0.761) | Precision: 0.719 (Test: 0.583) | Recall: 0.719 (Test: 1.000)
Epoch  55 | Time:  13 s | Acc: 0.758 (Test: 0.645) | AUC: 0.856 (Test: 0.796) | Precision: 0.766 (Test: 0.615) | Recall: 0.766 (Test: 0.571)
Epoch  56 | Time:  14 s | Acc: 0.750 (Test: 0.710) | AUC: 0.800 (Test: 0.805) | Precision: 0.789 (Test: 0.857) | Recall: 0.703 (Test: 0.429)
Epoch  57 | Time:  13 s | Acc: 0.766 (Test: 0.645) | AUC: 0.840 (Test: 0.773) | Precision: 0.807 (Test: 0.579) | Recall: 0.719 (Test: 0.786)
Epoch  58 | Time:  12 s | Acc: 0.798 (Test: 0.677) | AUC: 0.815 (Test: 0.792) | Precision: 0.820 (Test: 0.625) | Recall: 0.781 (Test: 0.714)
Epoch  59 | Time:  14 s | Acc: 0.734 (Test: 0.677) | AUC: 0.814 (Test: 0.779) | Precision: 0.746 (Test: 0.583) | Recall: 0.734 (Test: 1.000)
Epoch  60 | Time:  13 s | Acc: 0.677 (Test: 0.677) | AUC: 0.731 (Test: 0.796) | Precision: 0.714 (Test: 0.625) | Recall: 0.625 (Test: 0.714)
Epoch  61 | Time:  14 s | Acc: 0.766 (Test: 0.645) | AUC: 0.825 (Test: 0.805) | Precision: 0.769 (Test: 0.615) | Recall: 0.781 (Test: 0.571)
Epoch  62 | Time:  14 s | Acc: 0.774 (Test: 0.710) | AUC: 0.833 (Test: 0.782) | Precision: 0.800 (Test: 0.609) | Recall: 0.750 (Test: 1.000)
Traceback (most recent call last):
  File "/usr/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.7/dist-packages/tensorflow/python/framework/ops.py", line 5766, in get_controller
    yield g
  File "/content/tbcnn/train_loop.py", line 267, in train_net
    batch_imgs, batch_labs = sess.run(next_training)
  File "/usr/local/lib/python3.7/dist-packages/tensorflow/python/client/session.py", line 971, in run
    run_metadata_ptr)
  File "/usr/local/lib/python3.7/dist-packages/tensorflow/python/client/session.py", line 1194, in _run
    feed_dict_tensor, options, run_metadata)
  File "/usr/local/lib/python3.7/dist-packages/tensorflow/python/client/session.py", line 1374, in _do_run
    run_metadata)
  File "/usr/local/lib/python3.7/dist-packages/tensorflow/python/client/session.py", line 1380, in _do_call
    return fn(*args)
  File "/usr/local/lib/python3.7/dist-packages/tensorflow/python/client/session.py", line 1364, in _run_fn
    target_list, run_metadata)
  File "/usr/local/lib/python3.7/dist-packages/tensorflow/python/client/session.py", line 1458, in _call_tf_sessionrun
    run_metadata)
KeyboardInterrupt
During handling of the above exception, another exception occurred:
Traceback (most recent call last):
  File "train.py", line 50, in <module>
    train_variants.train_cross_validation(relPath('input'), epochs=epochs, sets=sets, size=SIZE)
  File "/content/tbcnn/train_variants.py", line 143, in train_cross_validation
    epochs=epochs,
  File "/content/tbcnn/train_loop.py", line 325, in train_net
    .format(e, elapsed, accuracy, test_accuracy, auc, test_auc, precision, test_precision, recall, test_recall)
  File "/usr/local/lib/python3.7/dist-packages/tensorflow/python/client/session.py", line 1654, in __exit__
    close_thread.start()
  File "/usr/lib/python3.7/threading.py", line 857, in start
    self._started.wait()
  File "/usr/lib/python3.7/threading.py", line 552, in wait
    signaled = self._cond.wait(timeout)
  File "/usr/lib/python3.7/threading.py", line 296, in wait
    waiter.acquire()
KeyboardInterrupt